# LangChain æŠ€æœ¯æ–¹æ¡ˆåˆ†æ

> **æ–‡æ¡£ç›®çš„**: åˆ†ææ—¥ç¨‹åŠ©æ‰‹å¼€å‘ä¸­æ˜¯å¦ä½¿ç”¨ LangChain æ¡†æ¶
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-11
> **é¡¹ç›®**: å¾®ä¿¡AIåŠ©æ‰‹ - ç¬¬äºŒé˜¶æ®µï¼ˆæ—¥ç¨‹åŠ©æ‰‹ï¼‰

---

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

åœ¨å¼€å‘æ—¥ç¨‹åŠ©æ‰‹åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å†³å®šæ˜¯ä½¿ç”¨ **LangChain** æ¡†æ¶ï¼Œè¿˜æ˜¯ç»§ç»­ä½¿ç”¨ **ç›´æ¥è°ƒç”¨ GLM API** çš„æ–¹å¼ã€‚

---

## ğŸ” æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆAï¼šä½¿ç”¨ LangChain

#### âœ… ä¼˜åŠ¿

1. **åŠŸèƒ½ä¸°å¯Œ**
   - å†…ç½® Agent ç³»ç»Ÿï¼Œæ”¯æŒå·¥å…·è°ƒç”¨
   - é¢„ç½®å¤šç§ Memory ç»„ä»¶ï¼ˆå¯¹è¯è®°å¿†ï¼‰
   - ä¸°å¯Œçš„ Chain ç±»å‹
   - æ”¯æŒå¤šç§ LLM æä¾›å•†

2. **å¼€å‘æ•ˆç‡**
   - å‡å°‘æ ·æ¿ä»£ç 
   - ç¤¾åŒºæœ‰å¤§é‡ç°æˆçš„å·¥å…·å’Œæ¨¡æ¿
   - æ–‡æ¡£å®Œå–„ï¼Œç¤¾åŒºæ´»è·ƒ

3. **å¯æ‰©å±•æ€§**
   - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½ï¼ˆRAGã€å‘é‡æ•°æ®åº“ç­‰ï¼‰
   - æ”¯æŒæ’ä»¶åŒ–çš„ Tools æœºåˆ¶
   - ä¾¿äºåç»­åŠŸèƒ½æ‰©å±•

4. **æ ‡å‡†åŒ–**
   - è¡Œä¸šæ ‡å‡†æ¡†æ¶ï¼Œå›¢é˜Ÿåä½œå‹å¥½
   - ä¾¿äºæ‹›è˜å’Œç»´æŠ¤

#### âŒ åŠ£åŠ¿

1. **å¤æ‚åº¦å¢åŠ **
   - éœ€è¦å­¦ä¹  LangChain æ¦‚å¿µæ¨¡å‹
   - è°ƒè¯•ç›¸å¯¹å›°éš¾
   - æŠ½è±¡å±‚çº§å¤šï¼Œæ€§èƒ½éš¾ä¼˜åŒ–

2. **æ€§èƒ½å¼€é”€**
   - é¢å¤–çš„æ¡†æ¶å±‚ï¼Œå¢åŠ å“åº”æ—¶é—´
   - å†…å­˜å ç”¨è¾ƒå¤§
   - å¯¹äºç®€å•åœºæ™¯ï¼Œæ€é¸¡ç”¨ç‰›åˆ€

3. **ä¾èµ–è¾ƒé‡**
   - éœ€è¦å®‰è£…å¤šä¸ªä¾èµ–åŒ…
   - ç‰ˆæœ¬æ›´æ–°å¿«ï¼Œå…¼å®¹æ€§é—®é¢˜
   - å¢åŠ é¡¹ç›®å¤æ‚åº¦

4. **è¿‡åº¦è®¾è®¡**
   - æ—¥ç¨‹åŠ©æ‰‹åœºæ™¯ç›¸å¯¹ç®€å•
   - ä¸éœ€è¦ LangChain çš„å…¨éƒ¨åŠŸèƒ½
   - å¯èƒ½é™åˆ¶çµæ´»æ€§

---

### æ–¹æ¡ˆBï¼šç›´æ¥è°ƒç”¨ GLM APIï¼ˆå½“å‰æ–¹æ¡ˆï¼‰

#### âœ… ä¼˜åŠ¿

1. **ç®€å•ç›´æ¥**
   - ä»£ç é‡å°‘ï¼Œæ˜“äºç†è§£
   - è°ƒè¯•æ–¹ä¾¿
   - æ€§èƒ½å¼€é”€å°

2. **çµæ´»å¯æ§**
   - å®Œå…¨æ§åˆ¶è°ƒç”¨é€»è¾‘
   - æ˜“äºä¼˜åŒ–å’Œå®šåˆ¶
   - ä¸å—æ¡†æ¶é™åˆ¶

3. **è½»é‡çº§**
   - åªéœ€ zai-sdk ä¸€ä¸ªä¾èµ–
   - èµ„æºå ç”¨å°‘
   - éƒ¨ç½²ç®€å•

4. **å­¦ä¹ æˆæœ¬ä½**
   - ç›´æ¥ä½¿ç”¨ GLM API
   - ä»£ç å³æ–‡æ¡£
   - æ˜“äºç»´æŠ¤

#### âŒ åŠ£åŠ¿

1. **éœ€è¦è‡ªå·±å®ç°**
   - å¯¹è¯è®°å¿†ç®¡ç†
   - å·¥å…·è°ƒç”¨é€»è¾‘
   - é”™è¯¯å¤„ç†

2. **æ‰©å±•æ€§æœ‰é™**
   - æ·»åŠ å¤æ‚åŠŸèƒ½éœ€è¦æ›´å¤šä»£ç 
   - åç»­å¦‚æœéœ€è¦ RAG ç­‰åŠŸèƒ½ï¼Œå·¥ä½œé‡å¤§

3. **æ ‡å‡†åŒ–ä¸è¶³**
   - ä»£ç é£æ ¼ä¾èµ–å¼€å‘è€…
   - å›¢é˜Ÿåä½œéœ€è¦æ›´å¤šè§„èŒƒ

---

## ğŸ¯ åœºæ™¯åˆ†æ

### æ—¥ç¨‹åŠ©æ‰‹çš„éœ€æ±‚

| éœ€æ±‚ | å¤æ‚åº¦ | LangChain å¸®åŠ©ç¨‹åº¦ |
|------|--------|-------------------|
| æ„å›¾è¯†åˆ« | ä¸­ç­‰ | â­â­â­ |
| æ—¶é—´è§£æ | ä½ | â­ï¼ˆéœ€è¦è‡ªå®šä¹‰ï¼‰ |
| æ•°æ®åº“æ“ä½œ | ä½ | â­ï¼ˆéœ€è¦è‡ªå®šä¹‰ï¼‰ |
| å¯¹è¯è®°å¿† | ä¸­ç­‰ | â­â­â­â­ |
| å·¥å…·è°ƒç”¨ | ä¸­ç­‰ | â­â­â­â­ |
| ä»»åŠ¡è°ƒåº¦ | ä½ | â­ï¼ˆéœ€è¦è‡ªå®šä¹‰ï¼‰ |

### ç»“è®º

æ—¥ç¨‹åŠ©æ‰‹çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆæ—¥ç¨‹CRUDã€æ—¶é—´è§£æã€ä»»åŠ¡è°ƒåº¦ï¼‰éƒ½æ˜¯**ä¸šåŠ¡é€»è¾‘**ï¼ŒLangChain å¸®åŠ©æœ‰é™ã€‚

---

## ğŸ’¡ æ¨èæ–¹æ¡ˆ

### ğŸ¥‡ æ–¹æ¡ˆä¸€ï¼šæ··åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰

**ä¸ä½¿ç”¨ LangChainï¼Œä½†ä¿æŒä»£ç ç»“æ„åŒ–**

```python
# è½»é‡çº§çš„æŠ½è±¡å±‚ï¼Œç±»ä¼¼ LangChain çš„æ€è·¯
class IntentRouter:
    """æ„å›¾è·¯ç”±å™¨"""

    def __init__(self, llm_client):
        self.llm_client = llm_client
        self.functions = {
            "create_schedule": self.create_schedule,
            "query_schedules": self.query_schedules,
            "delete_schedule": self.delete_schedule,
        }

    async def route(self, message: str, user_id: str):
        """æ ¹æ®ç”¨æˆ·æ¶ˆæ¯è·¯ç”±åˆ°å¯¹åº”çš„å‡½æ•°"""
        # ä½¿ç”¨ GLM Function Calling è¯†åˆ«æ„å›¾
        intent = await self.detect_intent(message)

        # æ‰§è¡Œå¯¹åº”å‡½æ•°
        if intent["name"] in self.functions:
            return await self.functions[intent["name"]](
                **intent["arguments"],
                user_id=user_id
            )

        # é»˜è®¤ä¸ºæ™®é€šå¯¹è¯
        return await self.chat(message, user_id)
```

**ä¼˜ç‚¹**:
- âœ… ä¿æŒç®€å•ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… å‚è€ƒäº† LangChain çš„è®¾è®¡æ€è·¯
- âœ… æ€§èƒ½å¥½ï¼Œèµ„æºå ç”¨å°‘
- âœ… çµæ´»å¯æ§ï¼Œæ˜“äºä¼˜åŒ–

**é€‚ç”¨åœºæ™¯**:
- æ—¥ç¨‹åŠ©æ‰‹è¿™ç§ä¸šåŠ¡é€»è¾‘é‡çš„åœºæ™¯
- éœ€è¦å¿«é€Ÿå¼€å‘å’Œè¿­ä»£
- å›¢é˜Ÿè§„æ¨¡å°

---

### ğŸ¥ˆ æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ LangChain

å¦‚æœæœªæ¥æœ‰ä»¥ä¸‹éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ LangChainï¼š

1. **éœ€è¦å¤æ‚çš„ Agent ç³»ç»Ÿ**
   - å¤šæ­¥æ¨ç†
   - è‡ªä¸»è§„åˆ’
   - åŠ¨æ€å·¥å…·é€‰æ‹©

2. **éœ€è¦ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰**
   - çŸ¥è¯†åº“é—®ç­”
   - æ–‡æ¡£ç†è§£
   - å‘é‡æ•°æ®åº“é›†æˆ

3. **éœ€è¦å¤šç§ LLM åˆ‡æ¢**
   - åŒæ—¶ä½¿ç”¨å¤šä¸ªæ¨¡å‹
   - A/B æµ‹è¯•ä¸åŒæ¨¡å‹
   - æˆæœ¬ä¼˜åŒ–

4. **å›¢é˜Ÿåä½œéœ€è¦æ ‡å‡†åŒ–**
   - å¤šäººå¼€å‘
   - ä»£ç è§„èŒƒ
   - é™ä½å­¦ä¹ æˆæœ¬

**å®ç°ç¤ºä¾‹**:

```python
from langchain.agents import create_openai_functions_agent
from langchain.tools import tool
from langchain_core.prompts import ChatPromptTemplate

# å®šä¹‰å·¥å…·
@tool
def create_schedule(title: str, datetime: str, description: str = ""):
    """åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥ç¨‹"""
    # å®ç°é€»è¾‘
    pass

@tool
def query_schedules(date: str = ""):
    """æŸ¥è¯¢ç”¨æˆ·çš„æ—¥ç¨‹"""
    # å®ç°é€»è¾‘
    pass

# åˆ›å»º Agent
tools = [create_schedule, query_schedules]
prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½æ—¥ç¨‹åŠ©æ‰‹"),
    ("human", "{input}"),
    ("placeholder", "{agent_scratchpad}"),
])

agent = create_openai_functions_agent(llm, tools, prompt)
```

---

## ğŸ“Š å†³ç­–çŸ©é˜µ

| è€ƒè™‘å› ç´  | æƒé‡ | ä¸ç”¨ LangChain | ä½¿ç”¨ LangChain |
|----------|------|----------------|----------------|
| å¼€å‘é€Ÿåº¦ | â­â­â­ | 7/10 | 8/10 |
| ä»£ç å¤æ‚åº¦ | â­â­â­â­ | 9/10 | 5/10 |
| æ€§èƒ½ | â­â­â­ | 9/10 | 6/10 |
| å¯ç»´æŠ¤æ€§ | â­â­â­â­ | 7/10 | 8/10 |
| æ‰©å±•æ€§ | â­â­ | 6/10 | 9/10 |
| å­¦ä¹ æˆæœ¬ | â­â­ | 9/10 | 5/10 |
| èµ„æºå ç”¨ | â­â­ | 9/10 | 6/10 |

**ç»¼åˆè¯„åˆ†**:
- **ä¸ç”¨ LangChain**: 7.7/10 â­â­â­â­
- **ä½¿ç”¨ LangChain**: 6.7/10 â­â­â­

---

## ğŸ¯ æœ€ç»ˆå»ºè®®

### å½“å‰é˜¶æ®µï¼ˆæ—¥ç¨‹åŠ©æ‰‹ï¼‰

**æ¨èï¼šä¸ä½¿ç”¨ LangChain**

ç†ç”±ï¼š
1. æ—¥ç¨‹åŠ©æ‰‹çš„æ ¸å¿ƒæ˜¯ä¸šåŠ¡é€»è¾‘ï¼ŒLangChain å¸®åŠ©æœ‰é™
2. å½“å‰çš„ GLM Function Calling å·²ç»å¤Ÿç”¨
3. ä¿æŒç®€å•ï¼Œå¿«é€Ÿè¿­ä»£
4. æ€§èƒ½æ›´å¥½ï¼Œèµ„æºå ç”¨å°‘

### æœªæ¥æ‰©å±•

å¦‚æœåç»­æœ‰ä»¥ä¸‹éœ€æ±‚ï¼Œå†è€ƒè™‘å¼•å…¥ LangChainï¼š

1. **çŸ¥è¯†åº“é—®ç­”** - éœ€è¦å‘é‡æ•°æ®åº“å’Œ RAG
2. **å¤æ‚æ¨ç†** - éœ€è¦å¤šæ­¥æ¨ç†å’Œè‡ªä¸»è§„åˆ’
3. **å¤šæ¨¡å‹é›†æˆ** - éœ€è¦åŒæ—¶ä½¿ç”¨å¤šä¸ª LLM
4. **å›¢é˜Ÿæ‰©å¤§** - éœ€è¦æ ‡å‡†åŒ–æ¡†æ¶

---

## ğŸ“ æŠ€æœ¯é€‰å‹å»ºè®®

### ç¬¬äºŒé˜¶æ®µæŠ€æœ¯æ ˆï¼ˆæ¨èï¼‰

```txt
# æ ¸å¿ƒ
fastapi==0.104.1
zai-sdk==0.2.2

# æ•°æ®åº“
sqlalchemy==2.0.23
alembic==1.13.0

# ä»»åŠ¡è°ƒåº¦
apscheduler==3.10.4

# æ—¶é—´è§£æ
dateparser==1.2.0

# ä¸ä½¿ç”¨ LangChain
```

### å¦‚æœé€‰æ‹© LangChain

```txt
# LangChain æ ¸å¿ƒ
langchain==0.1.0
langchain-openai==0.0.5

# å¯é€‰ï¼šå‘é‡æ•°æ®åº“
langchain-community==0.0.2
chromadb==0.4.22
```

---

## ğŸš€ å®ç°å»ºè®®

### è½»é‡çº§å®ç°ï¼ˆæ¨èï¼‰

```python
# services/schedule_agent.py
class ScheduleAgent:
    """è½»é‡çº§æ—¥ç¨‹ä»£ç†"""

    def __init__(self, ai_service, schedule_service):
        self.ai = ai_service
        self.schedule = schedule_service

    async def process(self, message: str, user_id: str):
        """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""

        # 1. ä½¿ç”¨ GLM Function Calling è¯†åˆ«æ„å›¾
        result = await self.ai.detect_intent(
            message=message,
            functions=[
                {
                    "name": "create_schedule",
                    "description": "åˆ›å»ºæ—¥ç¨‹",
                    "parameters": {...}
                },
                # ...
            ]
        )

        # 2. æ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡é€»è¾‘
        if result.function_call:
            return await self.execute_function(
                result.function_call,
                user_id
            )

        # 3. é»˜è®¤ä¸ºæ™®é€šå¯¹è¯
        return await self.ai.chat(message, user_id)
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [GLM Function Calling æ–‡æ¡£](https://open.bigmodel.cn/dev/api#aicompletions)
- [è½»é‡çº§ Agent è®¾è®¡æ¨¡å¼](https://python.langchain.com/docs/modules/agents/)

---

## âœ… å†³ç­–

**æ¨èæ–¹æ¡ˆ**: **ä¸ä½¿ç”¨ LangChain**ï¼Œé‡‡ç”¨è½»é‡çº§çš„è‡ªç ”æ–¹æ¡ˆ

**ç†ç”±æ€»ç»“**:
1. âœ… æ—¥ç¨‹åŠ©æ‰‹åœºæ™¯ç®€å•ï¼Œä¸éœ€è¦ LangChain çš„å¤æ‚åŠŸèƒ½
2. âœ… ç›´æ¥ä½¿ç”¨ GLM APIï¼Œæ€§èƒ½æ›´å¥½
3. âœ… ä»£ç é‡å°‘ï¼Œæ˜“äºç»´æŠ¤
4. âœ… ä¿æŒçµæ´»æ€§ï¼Œä¾¿äºä¼˜åŒ–

**åç»­æ‰©å±•**:
- å¦‚æœéœ€è¦å¤æ‚åŠŸèƒ½ï¼ˆRAGã€å‘é‡æ•°æ®åº“ï¼‰ï¼Œå†è€ƒè™‘å¼•å…¥ LangChain
- å½“å‰ä¿æŒç®€å•ï¼Œå¿«é€Ÿè¿­ä»£

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**åˆ›å»ºæ—¥æœŸ**: 2026-02-11
**å»ºè®®çŠ¶æ€**: æ¨èä¸ä½¿ç”¨ LangChain
